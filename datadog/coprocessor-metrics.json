{
  "title": "RR-69: Coprocessor Metrics",
  "description": "[[suggested_dashboards]]",
  "widgets": [
    {
      "id": 7179021198358280,
      "definition": {
        "title": "Coprocessors",
        "background_color": "white",
        "show_title": true,
        "type": "group",
        "layout_type": "ordered",
        "widgets": [
          {
            "id": 2752267629213285,
            "definition": {
              "type": "note",
              "content": "If you incorporate [coprocessors](https://www.apollographql.com/docs/graphos/routing/customization/coprocessor) into your runtime, these metrics will be emitted. They indicate basic health and performance impact of the coprocessors on your request lifecycle. In order to correlate any issues we highly recommend you add your own instrumentation to this section to include any health and performance metrics specific to the coprocessors you run and their own request lifecyle.",
              "background_color": "white",
              "font_size": "14",
              "text_align": "left",
              "vertical_align": "top",
              "show_tick": false,
              "tick_pos": "50%",
              "tick_edge": "left",
              "has_padding": true
            },
            "layout": {
              "x": 0,
              "y": 0,
              "width": 12,
              "height": 1
            }
          },
          {
            "id": 7202644430123243,
            "definition": {
              "title": "Coprocessor Request Duration",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": [
                "avg",
                "min",
                "max",
                "value",
                "sum"
              ],
              "time": {},
              "type": "timeseries",
              "requests": [
                {
                  "response_format": "timeseries",
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "avg:apollo.router.operations.coprocessor.duration{service:$service.value,env:$env.value,version:$version.value} by {coprocessor.stage}"
                    }
                  ],
                  "formulas": [
                    {
                      "formula": "query1"
                    }
                  ],
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ]
            },
            "layout": {
              "x": 0,
              "y": 1,
              "width": 4,
              "height": 4
            }
          },
          {
            "id": 8422381032516479,
            "definition": {
              "title": "Coprocessor Request Count",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": [
                "avg",
                "min",
                "max",
                "value",
                "sum"
              ],
              "time": {},
              "type": "timeseries",
              "requests": [
                {
                  "response_format": "timeseries",
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query0",
                      "query": "sum:apollo.router.operations.coprocessor{service:$service.value,env:$env.value,version:$version.value} by {coprocessor.stage}.as_count()"
                    }
                  ],
                  "formulas": [
                    {
                      "alias": "coprocessor request count",
                      "formula": "query0"
                    }
                  ],
                  "style": {
                    "palette": "dog_classic",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "bars"
                }
              ]
            },
            "layout": {
              "x": 4,
              "y": 1,
              "width": 4,
              "height": 4
            }
          },
          {
            "id": 1752147216961256,
            "definition": {
              "title": "Coprocessor Success Rate",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": [
                "avg",
                "min",
                "max",
                "value",
                "sum"
              ],
              "time": {},
              "type": "timeseries",
              "requests": [
                {
                  "response_format": "timeseries",
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query0",
                      "query": "sum:apollo.router.operations.coprocessor{service:$service.value,env:$env.value,version:$version.value, coprocessor.succeeded:true} by {coprocessor.stage}.as_count()"
                    },
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "sum:apollo.router.operations.coprocessor{service:$service.value,env:$env.value,version:$version.value} by {coprocessor.stage}.as_count()"
                    }
                  ],
                  "formulas": [
                    {
                      "alias": "coprocessor success rate",
                      "formula": "query0 / query1 * 100",
                      "number_format": {
                        "unit": {
                          "type": "canonical_unit",
                          "unit_name": "percent"
                        }
                      }
                    }
                  ],
                  "style": {
                    "palette": "dog_classic",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ]
            },
            "layout": {
              "x": 8,
              "y": 1,
              "width": 4,
              "height": 4
            }
          }
        ]
      },
      "layout": {
        "x": 0,
        "y": 0,
        "width": 12,
        "height": 6
      }
    }
  ],
  "template_variables": [
    {
      "name": "service",
      "prefix": "service",
      "available_values": [],
      "default": "router"
    },
    {
      "name": "env",
      "prefix": "env",
      "available_values": [],
      "default": "prod"
    },
    {
      "name": "version",
      "prefix": "version",
      "available_values": [],
      "default": "*"
    }
  ],
  "layout_type": "ordered",
  "notify_list": [],
  "reflow_type": "fixed",
  "tags": [
    "team:runtime-readiness"
  ]
}
